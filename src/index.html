<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Step Counter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
    <div id="app" class="bg-white shadow-xl rounded-2xl p-8 max-w-sm w-full text-center space-y-6">
        <h1 class="text-4xl font-bold text-indigo-600">Step Tracker</h1>
        <p class="text-gray-500">Track your progress and stay active.</p>

        <div id="status" class="text-sm text-gray-400">
            Initializing...
        </div>

        <div id="step-display" class="hidden">
            <div class="bg-indigo-100 rounded-xl p-6 mb-4">
                <p class="text-sm font-medium text-indigo-600 uppercase tracking-wide">Steps Today</p>
                <p id="step-count" class="text-6xl font-extrabold text-indigo-700 mt-2">0</p>
            </div>
            
            <button id="add-step-btn" class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-xl hover:bg-indigo-700 transition duration-300 transform hover:scale-105 shadow-lg">
                <span class="text-xl">+1 Step</span>
            </button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- IMPORTANT: PASTE YOUR FIREBASE CONFIG HERE ---
        // You need to replace the placeholder below with your actual Firebase config object.
        // It should look like: const firebaseConfig = { apiKey: "...", ... };
        const firebaseConfig = {
          apiKey: "AIzaSyB8cKvTGY-dGfC_Hj7quM_BN8GYfpnBE6g",
  authDomain: "step-counter-dfa03.firebaseapp.com",
  projectId: "step-counter-dfa03",
  storageBucket: "step-counter-dfa03.firebasestorage.app",
  messagingSenderId: "28666344542",
  appId: "1:28666344542:web:eebb589b662868ac0eb0cf"
        };

        const appId = 'step-counter-app';

        let app;
        let db;
        let auth;
        let userId;

        const statusEl = document.getElementById('status');
        const stepDisplayEl = document.getElementById('step-display');
        const stepCountEl = document.getElementById('step-count');
        const addStepBtn = document.getElementById('add-step-btn');

        // Function to handle database connection
        async function connectToDb() {
            try {
                // Check if firebaseConfig is valid
                if (!firebaseConfig || !firebaseConfig.projectId) {
                    statusEl.textContent = 'Error: Firebase config not found. Please add your config to the code.';
                    return;
                }

                // Initialize Firebase and get service instances
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                // Sign in anonymously if no auth token is available
                // In a production app, you might use a different authentication method
                await signInAnonymously(auth);

                // Wait for auth state to be ready
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        statusEl.textContent = 'Ready! Tap to add steps.';
                        stepDisplayEl.classList.remove('hidden');
                        
                        // Set up a real-time listener for the user's steps
                        const userDocRef = doc(db, `/artifacts/${appId}/users/${userId}/steps/today`);
                        onSnapshot(userDocRef, (docSnap) => {
                            if (docSnap.exists()) {
                                const data = docSnap.data();
                                const steps = data.count || 0;
                                stepCountEl.textContent = steps;
                            } else {
                                stepCountEl.textContent = 0;
                            }
                        });
                    }
                });

            } catch (error) {
                console.error("Failed to initialize Firebase:", error);
                statusEl.textContent = 'Error: Failed to connect to Firebase. Check the console for details.';
            }
        }

        // Add a click listener to the button
        addStepBtn.addEventListener('click', async () => {
            if (!userId) {
                statusEl.textContent = 'Please wait, app is not ready yet.';
                return;
            }

            // Reference to the steps document
            const today = new Date().toISOString().split('T')[0];
            const userDocRef = doc(db, `/artifacts/${appId}/users/${userId}/steps/today`);

            try {
                // Get the current document data
                const docSnap = await getDoc(userDocRef);
                let currentSteps = 0;

                if (docSnap.exists()) {
                    currentSteps = docSnap.data().count || 0;
                }

                // Increment the step count and update the document
                await setDoc(userDocRef, { count: currentSteps + 1, lastUpdated: new Date() }, { merge: true });

            } catch (e) {
                console.error("Error adding step:", e);
                statusEl.textContent = 'Error adding step. See console.';
            }
        });

        // Start the process on page load
        window.onload = connectToDb;
    </script>
</body>
</html>
